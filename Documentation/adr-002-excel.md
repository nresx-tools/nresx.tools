# ADR 002: Вибір технології (бібліотеки) для роботи з файлами \*.xlsx для C\#

### Дата: 10.11.2023

### Статус: Запропоновано

### Контекст

Застосунок "Звітність" передбачає роботу з файлами \*.xlsx. Це включає в себе як експорт так і імпорт звітів.
Нам потрібна відповідна бібліотека, яка може парсити та генерувати файли звітності навіть при відсутності встановленого MS Excel на робочій станції.
Враховуючі достатньо великий об'єм, та кількість звітів, з якими доведеться працювати оператору (принаймні в підрозділах рівня блигади та вище) критичним є фактор швидкості роботи бібліотеки.
Також враховуючі відсутність бюджету для придбання сторонніх компонентів бібліотека має бути доступною безкоштовно для некомерційного використання в державних установах.

### Рішення

У контексті потреби роботи з файлами \*.xlsx для забезпечення ефективного експорту та імпорту звітів у застосунку "Звітність", було прийнято рішення використовувати бібліотеку EPPlus. 
Ця бібліотека відповідає всім критеріям наших вимог:
EPPlus дозволяє парсити та генерувати файли Excel при відсутності встановленого MS Excel на робочій станції.
Здатна забезпечити швидку та ефективну обробку великого об'єму звітів.
З версії 5.х (поточна стабільна версія - 7.х) розповзюджується за ліцензію [PolyForm Noncommercial License 1.0.0](https://polyformproject.org/licenses/noncommercial/1.0.0), 
яка дозволяє використовувати продукт безкоштовно для некомерційних державних установ.

### Наслідки

1. Висновок про легальність безкоштовного використання поточної ліцензії (PolyForm Noncommercial 1.0.0) в наших умовах був зроблений на основі відкритих даних.
Офіційне підтвердження від юристів відсутнє.
2. Даний продукт має історію зміни ліцензії в минулому (до в 4.х була LGPL 3.0), 
відповідно в разі зміни ліцензії в майбутньому і необхідності оновлення версії бібліотеки, це оновлення може бути ускладнене.

### Альтернативи

Були розглянуті наступні альтернативи:

| Технологія                                                                | працює без MSExcel | Зручність використання | Активна підтримка | Підтримка формул  | Швидкість роботи | Вартість       |
|---------------------------------------------------------------------------|--------------------| -----------------------|-------------------|-------------------|------------------|----------------|
| Office interop                                                            | ~~ні~~             | ~~Низька~~             | Так               | Так               | ~~Низька~~       | Безкоштовно    |
| OpenXML                                                                   | так                | ~~Середня~~            | Так               | Так               | Висока           | Безкоштовно    |
| [Aspose.Cells](https://docs.aspose.com/cells/net)                         | так                | Висока                 | Так               | Так               | Висока           | ~~Комерційна~~     |
| [**EPPlus 7.x**](https://www.epplussoftware.com)                          | **так**            | **Висока**             | **Так**           | **Так**           | **Висока (677ms)**   | **[PolyForm Noncommercial 1.0.0](https://polyformproject.org/licenses/noncommercial/1.0.0)**    |
| [NPOI](https://github.com/dotnetcore/NPOI)                                | так                | Висока                 | Так               | Так               | Висока (1700ms)  | [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0)    |
| [SmartXLS](https://www.smartxls.com/index.htm)                            | так                | ~~Середня~~            | Так               | Так               | Висока           | ~~Commercial opensource~~     |
| [Spire](https://www.e-iceblue.com/Introduce/excel-for-net-introduce.html) | так                | Висока                 | Так               | Так               | Висока           | ~~Commercial opensource~~     |

